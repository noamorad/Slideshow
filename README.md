# פרוטוקול תקשורת SPI - נקודות דיבור

## מאסטר-סלייב
• ב-SPI, המאסטר (בדרך כלל מיקרו-בקר) הוא המוח של המערכת - הוא יוזם את כל התקשורת, מייצר את אות השעון ובוחר עם איזה סלייב לדבר באמצעות קו הבחירה (SS/CS).
• הסלייבים (כמו חיישנים או זיכרונות) ממלאים תפקיד פסיבי לחלוטין - הם רק מגיבים כאשר המאסטר פונה אליהם ואינם יכולים ליזום תקשורת, אפילו כשיש להם מידע חשוב להעביר.
• היררכיה ברורה זו מאפשרת ל-SPI לפעול ללא התנגשויות נתונים ועם פרוטוקול פשוט, אך היא גם יוצרת תלות מוחלטת במאסטר שתקלה בו תשבית את כל המערכת.

## סוגי דופלקס
• SPI סטנדרטי תומך בתקשורת דופלקס מלא, שבה המאסטר והסלייב יכולים לשלוח ולקבל נתונים בו-זמנית דרך קווי MOSI ו-MISO נפרדים, מה שמאפשר יעילות גבוהה בהעברת נתונים.
• בגרסאות SPI עם שלושה חוטים בלבד, משתמשים בקו נתונים דו-כיווני אחד במקום MOSI ו-MISO נפרדים, מה שמגביל את התקשורת לחצי-דופלקס (כיוון אחד בכל פעם).
• למרות שתיאורטית אפשר להשתמש ב-SPI במצב סימפלקס (כיוון אחד בלבד), זהו שימוש נדיר שלא מנצל את היכולות המלאות של הפרוטוקול, אך עשוי להתאים למקרים שבהם התקן אחד רק שולח והשני רק מקבל.

## תקשורת טורית/מקבילית
• SPI הוא פרוטוקול תקשורת טורי, שבו הנתונים נשלחים סיבית אחר סיבית על אותו קו, בניגוד לתקשורת מקבילית שבה כל הסיביות נשלחות בו-זמנית על קווים נפרדים.
• התקשורת הטורית של SPI מאפשרת מספר קטן של קווים (ארבעה בסך הכל), מה שמפחית את מורכבות החיווט, מקטין את ההפרעות האלקטרומגנטיות ומוזיל את העלויות.
• אף שתקשורת טורית איטית יותר תיאורטית מתקשורת מקבילית, תדרי השעון הגבוהים של SPI (מעל 10MHz) מפצים על כך, ומאפשרים קצב העברת נתונים מהיר שמספיק למרבית היישומים.

## תקשורת סינכרונית/אסינכרונית
• SPI הוא פרוטוקול תקשורת סינכרוני, שבו המאסטר מספק אות שעון (SCLK) שמסנכרן את העברת הנתונים בין ההתקנים, כך שכל סיבית מועברת בהתאמה מדויקת לדופק השעון.
• בזכות הסנכרון, אין צורך בסיביות התחלה/סיום כמו בתקשורת אסינכרונית (למשל UART), מה שמייעל את הפרוטוקול ומאפשר ניצול מרבי של הקצב להעברת נתונים ולא לתקורה.
• המאסטר יכול לקבוע את תצורת העבודה באמצעות קיטוב (CPOL) ופאזה (CPHA) של השעון, הקובעים האם הנתונים נדגמים בעליית או בירידת השעון, מה שמאפשר גמישות בהתאמת הפרוטוקול להתקנים שונים.

## תקשורת דיפרנציאלית/חד-קוטבית
• SPI סטנדרטי משתמש בתקשורת חד-קוטבית, שבה כל אות מועבר על חוט יחיד ביחס לאדמה משותפת, מה שמפשט את החיווט אך מגביל את עמידות הפרוטוקול לרעשים חשמליים.
• תקשורת דיפרנציאלית, שבה כל אות מועבר על זוג חוטים עם מתחים הפוכים, אינה חלק מהתקן הרגיל של SPI, אך קיימת בגרסאות מיוחדות המיועדות לסביבות רועשות או למרחקים ארוכים יותר.
• השימוש בתקשורת חד-קוטבית בפרוטוקול SPI הוא אחת הסיבות העיקריות להגבלת אורך הכבל לכמטר אחד, שכן מעבר לכך האותות נוטים להיפגע מרעשים ומהתנגדות הכבל.

## פינים וחיווט פיזי
• SPI סטנדרטי משתמש בארבעה פינים עיקריים: SCLK (אות השעון), MOSI (נתונים מהמאסטר לסלייב), MISO (נתונים מהסלייב למאסטר), ו-SS/CS (בחירת הסלייב הפעיל).
• בחיבור מרובה-סלייבים, המאסטר צריך להקצות קו SS/CS נפרד לכל סלייב, בעוד ששאר הקווים (SCLK, MOSI, MISO) משותפים לכל הסלייבים במערכת, מה שמציב מגבלה מעשית על מספר ההתקנים שניתן לחבר.
• קיימות גם תצורות חיבור חלופיות כמו "שרשרת" (daisy-chain), שבה הסלייבים מחוברים בטור אחד לשני (MISO של אחד מתחבר ל-MOSI של השני), מה שחוסך בקווי SS/CS אך דורש פרוטוקול מורכב יותר.

## אורך כבל ומפרטים
• SPI מתוכנן לתקשורת למרחקים קצרים, עם אורך כבל מקסימלי מומלץ של כמטר אחד, בשל היותו פרוטוקול חד-קוטבי הרגיש לרעשים ולירידת איכות האות במרחקים ארוכים.
• קצב העברת הנתונים הטיפוסי ב-SPI נע בין 1MHz ל-50MHz, כתלות ביישום, באיכות החיווט ובאורך הכבל, כאשר קצבים גבוהים יותר אפשריים בחיבורים קצרים במיוחד.
• בניגוד לפרוטוקולים אחרים, SPI אינו מגביל את גודל חבילת הנתונים ל-8 סיביות ואינו מחייב תבנית פריימים קבועה, מה שמאפשר גמישות רבה בהעברת נתונים בגדלים שונים, מסיבית בודדת ועד למספר רב של בתים.

## יתרונות SPI
• יתרון מרכזי של SPI הוא המהירות הגבוהה (מעל 10MHz) ותמיכה בתקשורת דופלקס מלאה, המאפשרים העברת נתונים יעילה במיוחד עבור יישומים הדורשים תפוקה גבוהה.
• הפרוטוקול פשוט ליישום בחומרה, עם צריכת חשמל נמוכה יחסית וללא תקורה של כתובות או אישורים, מה שהופך אותו לאידיאלי למערכות משובצות בעלות משאבים מוגבלים.
• SPI מאפשר גמישות רבה בגודל חבילות הנתונים וללא קביעת פורמט קבוע, כך שניתן להעביר נתונים בכל גודל רצוי ולהתאים את הפרוטוקול לצרכים ספציפיים של היישום.

## חסרונות SPI
• חיסרון בולט של SPI הוא הצורך ביותר חוטים בהשוואה לפרוטוקולים אחרים (כמו I²C), ובמיוחד הצורך בקו SS נפרד לכל סלייב, מה שמקשה על חיבור מספר רב של התקנים ומגדיל את מורכבות החיווט.
• הפרוטוקול מוגבל למרחקים קצרים (כמטר אחד) בגלל היעדר איתות דיפרנציאלי, ופגיע לרעשים חשמליים, מה שמגביל את השימוש בו לתקשורת בתוך אותו המעגל או לוח.
• SPI חסר מנגנונים מובנים לגילוי שגיאות, אישור קבלת נתונים או בקרת זרימה, וסלייבים אינם יכולים ליזום תקשורת, מה שמקשה על זיהוי תקלות ומגביל את השימושים במערכות שבהן ההתקנים צריכים להתריע על אירועים.

## שימושים נפוצים
• SPI משמש נפוץ בתקשורת עם רכיבי זיכרון כמו פלאש, EEPROM וכרטיסי SD, בזכות המהירות הגבוהה שלו והיכולת להעביר בלוקים גדולים של נתונים ביעילות.
• הפרוטוקול אידיאלי לחיבור חיישנים (טמפרטורה, לחץ, תאוצה, ג'יירו) וממירים (ADC, DAC) למיקרו-בקרים, שכן הוא מאפשר דגימה מהירה וקריאת ערכים ללא השהיות מיותרות.
• SPI משמש גם בתצוגות (LCD, OLED), בבקרי תקשורת ובמעגלי שעון זמן-אמת, במיוחד ביישומים שבהם חשובה צריכת אנרגיה נמוכה, תקשורת מהירה או פשטות החיווט והיישום.
